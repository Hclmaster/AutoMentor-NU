<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Request Form</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
</head>
<body>
<h1>Sending Request Message</h1>
<form >
    <p>Student Id: <input type="text" id="studentId" /></p>
    <p>Student Name: <input type="text" id="studentName" /></p>
    <p>Message: <input type="text" id="message" style="height: 100px; width: 200px;"/></p>
    <h2>Text Blocks: </h2>
    <div id="textBlocks" >
        <p>Label: <input type="text" name="label" id="input_label1" class="input_label" placeholder="Enter Text" /></p>
        <p>Text: <input type="text" name="text" id="input_text1" class="input_text" placeholder="Enter Text"/></p>
        <p>Type: <input type="text" name="type" id="input_type1" class="input_type" placeholder="Enter Text"/></p>

    </div>
    <input type="button" value="Add TextBox" onclick="add_field();" />
    <input type="button" value="Submit!" onclick="showJSON()" />
</form>

<h1>Display Request JSON</h1>
<textarea id="requestJSON" style="width: 50%; height: 200px;">Request JSON Text!</textarea>

<h1>Response JSON Message</h1>
<textarea id="responseJSON" style="width: 50%; height: 200px;">Response JSON Text!</textarea>

</body>
<script>
    function add_field() {
        var total_label = document.getElementsByClassName("input_label");
        total_label = total_label.length + 1;
        var total_text = document.getElementsByClassName("input_text");
        total_text = total_text.length + 1;
        var total_type = document.getElementsByClassName("input_type");
        total_type = total_type.length + 1;
        document.getElementById("textBlocks").innerHTML=document.getElementById("textBlocks").innerHTML+
            "<p>Label: <input type='text' class='input_label' id='input_label"+total_label+"' placeholder='Enter Text'>"+
            "<p>Text: <input type='text' class='input_text' id='input_text"+total_text+"' placeholder='Enter Text'>"+
            "<p>Type: <input type='text' class='input_type' id='input_type"+total_label+"' placeholder='Enter Text'>";

    }
    
    function showJSON() {
        var jsonObj = {};
        jsonObj['student'] = {"id" : document.getElementById('studentId').value,
                                "name" : document.getElementById('studentName').value};

        jsonObj['message'] = document.getElementById('message').value;

        var total_label = document.getElementsByClassName("input_label");
        var len = document.getElementsByClassName("input_label").length;
        var jsonArr = [];
        for(var i=1; i<=len; i++){
            var tmpJson = {};
            var strLabelId = 'input_label' + i;
            var strTextId = 'input_text' + i;
            var strTypeId = 'input_type' + i;
            tmpJson['label'] = document.getElementById(strLabelId).value;
            tmpJson['text'] = document.getElementById(strTextId).value;
            tmpJson['type'] = document.getElementById(strTypeId).value;
            jsonArr.push(tmpJson);
        }
        jsonObj['textBlocks'] = jsonArr;

        console.log("jsonobj ====> ",JSON.stringify(jsonObj));
        //document.getElementById("requestJSON").value = JSON.stringify(jsonObj);

        showRequestJSON(jsonObj);
        showResponseJSON(jsonObj);
    }

    function showRequestJSON(jsonObj){
        document.getElementById("requestJSON").value = JSON.stringify(jsonObj);
    }

    function showResponseJSON(jsonObj){
        //console.log("is it here???????? =======>");
        $.ajax({
            type: 'POST',
            url: "/api/form",
            headers: {
                "Content-Type": "application/json",
                "Accept": "application/json"
            },
            data: JSON.stringify(jsonObj),
            success : function (responseData) {
                //console.log("success ===> ",responseData);
                document.getElementById("responseJSON").value = JSON.stringify(responseData);
            }
        });
    }
</script>
</html>